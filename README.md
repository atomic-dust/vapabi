# vapabi

[![Build Status][travis-image]][travis-url][![Build coverage][coveralls-image]][coveralls-url]

[travis-image]: https://travis-ci.org/rust-vapory/vapabi.svg?branch=master
[travis-url]: https://travis-ci.org/rust-vapory/vapabi
[coveralls-image]: https://coveralls.io/repos/github/rust-vapory/vapabi/badge.svg?branch=master
[coveralls-url]: http://coveralls.io/github/rust-vapory/vapabi?branch=master

The ABI, Application Binary Interface, is basically how you call functions in a contract and get data back.

> An ABI determines such details as how functions are called and in which binary format information should be passed from one program component to the next...

An Vapory smart contract is bytecode, VVM, on the Vapory blockchain. Among the EVM, there could be several functions in a contract. An ABI is necessary so that you can specify which function in the contract to invoke, as well as get a guarantee that the function will return data in the format you are expecting. [read more](http://vapory.stackexchange.com/a/1171/394)

This library encodes function calls and decodes their output.

[Documentation](https://docs.rs/vapabi)

### Disclaimer

This library intends to support only valid ABIs generated by recent Solidity versions. Specifically, we don't intend to support ABIs that are invalid due to known Solidity bugs or by external libraries that don't strictly follow the specification.
Please make sure to pre-process your ABI in case it's not supported before using it with `vapabi`.

### Installation

- via cargo

  ```
  cargo install vapabi-cli
  ```

- via homebrew

  ```
  brew tap rust-vapory/rust-vapory
  brew install vapabi
  ```

### Usage

```
Vapory ABI coder.
  Copyright 2016-2017 Parity Technologies (UK) Limited

Usage:
    vapabi encode function <abi-path> <function-name> [-p <param>]... [-l | --lenient]
    vapabi encode params [-v <type> <param>]... [-l | --lenient]
    vapabi decode function <abi-path> <function-name> <data>
    vapabi decode params [-t <type>]... <data>
    vapabi decode log <abi-path> <event-name> [-l <topic>]... <data>
    vapabi -h | --help

Options:
    -h, --help         Display this message and exit.
    -l, --lenient      Allow short representation of input params.

Commands:
    encode             Encode ABI call.
    decode             Decode ABI call result.
    function           Load function from json ABI file.
    params             Specify types of input params inline.
    log                Decode event log.
```

### Examples

```
vapabi encode params -v bool 1
```

> 0000000000000000000000000000000000000000000000000000000000000001

--

```
vapabi encode params -v bool 1 -v string gavofyork -v bool 0
```

> 00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096761766f66796f726b0000000000000000000000000000000000000000000000

--

```
vapabi encode params -v bool[] [1,0,false]
```

> 00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

--

```
vapabi encode function examples/test.json foo -p 1
```

```json
[{
	"type":"function",
	"inputs": [{
		"name":"a",
		"type":"bool"
	}],
	"name":"foo",
	"outputs": []
}]
```

> 455575780000000000000000000000000000000000000000000000000000000000000001

--

```
vapabi decode params -t bool 0000000000000000000000000000000000000000000000000000000000000001
```

> bool true

--

```
vapabi decode params -t bool -t string -t bool 00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096761766f66796f726b0000000000000000000000000000000000000000000000
```

> bool true<br/>
> string gavofyork<br/>
> bool false

--

```
vapabi decode params -t bool[] 00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
```

> bool[] [true,false,false]

--

```
vapabi decode function ./examples/foo.json bar 0000000000000000000000000000000000000000000000000000000000000001
```

```json
[{
	"constant":false,
	"inputs":[{
		"name":"hello",
		"type":"address"
	}],
	"name":"bar",
	"outputs":[{
		"name":"",
		"type":"bool"
	}],
	"type":"function"
}]
```

> bool true

--

```
vapabi decode log ./examples/event.json Event -l 0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000004444444444444444444444444444444444444444
```

> a bool true<br/>
> b address 4444444444444444444444444444444444444444

### Alternative tools

-  [vapabi-js](https://github.com/jacogr/vapabi-js) - javascript port of this library created by [@jacogr](https://github.com/jacogr)

## Tetsy Vapory toolchain

In addition to the Tetsy Vaory client, there are additional tools in this repository available:

- [evmbin](https://github.com/openvapory/tetsy-vapory/blob/master/vvmbin/) - VVM implementation for Tetsy Vapory.
- [vapabi](https://github.com/rust-vapory/vapabi) - Tetsy Vapory function calls encoding.
- [vapstore](https://github.com/openvapory/tetsy-vapory/blob/master/vapstore/) - Tetsy Vapory key management.
- [vapkey](https://github.com/openvapory/tetsy-vapory/blob/master/vapkey/) - Tetsy Vapory keys generator.
- [whisper](https://github.com/openvapory/tetsy-vapory/blob/master/whisper/) - Implementation of Whisper-v2 PoC.
